import streamlit as st
import pandas as pd

# 1. ì£¼ì†Œ ì„¤ì •
SHEET_URL = "https://docs.google.com/spreadsheets/d/1ZF0lZ3Fiuelb5tntJl6m7xE1Lomkegpm1wD1TA_e5Qk/gviz/tq?tqx=out:csv"

st.set_page_config(page_title="ì„œí¬ìŠ¹ ê³¼ì¥ ì£¼ê°„ê³„íšì„œ", layout="wide")

@st.cache_data(ttl=60)
def load_data():
    # ë°ì´í„° ë¡œë“œ
    df = pd.read_csv(SHEET_URL)
    
    # 1) ìš”ì¼ ë°ì´í„°ê°€ ìˆëŠ” í–‰ ì°¾ê¸° ('ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ'ì„ ì°¾ìŠµë‹ˆë‹¤)
    # ì²« ë²ˆì§¸ ì—´(ì¼ì/ìš”ì¼)ì„ ê¸°ì¤€ìœ¼ë¡œ í•„í„°ë§í•©ë‹ˆë‹¤.
    target_days = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ']
    
    # ë°ì´í„°í”„ë ˆì„ì˜ ëª¨ë“  ì—´ ì´ë¦„ì„ ì´ˆê¸°í™”í•˜ì—¬ ì¸ë±ìŠ¤ë¡œ ì ‘ê·¼í•˜ê¸° ì‰½ê²Œ ë§Œë“­ë‹ˆë‹¤.
    df.columns = [i for i in range(len(df.columns))]
    
    # ìš”ì¼ì´ í¬í•¨ëœ í–‰ë§Œ ì¶”ì¶œ
    filtered = df[df[0].isin(target_days)].copy()
    
    # í•„ìš”í•œ ì—´ë§Œ ì„ íƒ (0:ìš”ì¼, 1:ì „ì£¼ê³„íš, 2:ì „ì£¼ì‹¤í–‰, 3:ê¸ˆì£¼ê³„íš)
    # ì‹œíŠ¸ êµ¬ì¡°ì— ë”°ë¼ ì—´ ë²ˆí˜¸ëŠ” [0, 1, 2, 3]ìœ¼ë¡œ ë§¤ì¹­ë©ë‹ˆë‹¤.
    result = filtered[[0, 1, 2, 3]]
    result.columns = ['ìš”ì¼', 'ì „ì£¼ ê³„íš', 'ì „ì£¼ ì‹¤í–‰', 'ê¸ˆì£¼ ê³„íš']
    
    return result

st.title("ğŸ“… ì£¼ê°„ ì—…ë¬´ ê³„íš ë³´ê³ ")
st.markdown("### ğŸ‘¤ ì‘ì„±ì: ì„œí¬ìŠ¹ ê³¼ì¥ (êµ¬ì§€ ì›ë£ŒíŒ€)")

try:
    plan_data = load_data()
    
    if not plan_data.empty:
        # í‘œ í˜•ì‹ìœ¼ë¡œ ì¶œë ¥
        st.subheader("ğŸ—“ï¸ ìš”ì¼ë³„ ì„¸ë¶€ ê³„íš ë° ì‹¤í–‰ í˜„í™©")
        
        # ë°ì´í„°ê°€ ê¹”ë”í•˜ê²Œ ë³´ì´ë„ë¡ ìŠ¤íƒ€ì¼ ì ìš©
        st.table(plan_data)
        
        st.info(f"ğŸ’¡ ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: {pd.Timestamp.now().strftime('%Y-%m-%d %H:%M:%S')}")
        st.success("ì‚¬ì¥ë‹˜, ìœ„ í‘œëŠ” êµ¬ê¸€ ì‹œíŠ¸ì˜ ë‚´ìš©ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.")
    else:
        st.error("ìš”ì¼ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹œíŠ¸ì˜ ì²« ë²ˆì§¸ ì—´ì— 'ì›”', 'í™”' ë“±ì˜ ìš”ì¼ì´ ì •í™•íˆ ì…ë ¥ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.")

except Exception as e:
    st.error(f"ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")
